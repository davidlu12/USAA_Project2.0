<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>QuestionsPage</title>

    <style>
        /*.dbQuestionsTitle {
            overflow: hidden;
            background-color: rgba(0,0,0,.03);
        }*/
    </style>

    <script>
        var name = "Hailee Copter";
        var department;
        department = "IT"// dummy data

        var questionsArray;
        var feedbackArray = [];// Feedback Array. FeedbackID, Feedback(response), approved?, QuestionID

        function loadQuestions() {
            var webMethod = "../QuestionsService.asmx/GetQuestions";
            $.ajax({
                type: "POST",
                url: webMethod,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d.length > 0) {
                        questionsArray = msg.d;

                        for (var i = 0; i < questionsArray.length; i++) {
                            if (questionsArray[i].DepartmentName == department) {
                                $("#questionBox").append("<tr>" +
                                "<td>" + questionsArray[i].Question + "</td>" +
                                    "</tr>");

                                var ratingInput = document.createElement('input');
                                var textboxInput = document.createElement('input');
                                var saveButton = document.createElement('input');

                                    $("#questionBox").append("<tr>"); // for rating

                                    for (var j = 0; j < 4; j++) {
                                        ratingInput = document.createElement('input');
                                        ratingInput.type = "radio";
                                        ratingInput.id = questionsArray[i].QuestionID;
                                        ratingInput.class = "answer";
                                        ratingInput.name = "test";
                                        ratingInput.value = j+1;
                                        $("#questionBox").append("<tr>" + "<td>", ratingInput, ratingInput.value, "</td>" + "</tr>");
                                        feedbackArray.push([ratingInput, false, ratingInput.id]);
                                    }
                                    $("#questionBox").append("</tr>");

                                    textboxInput.type = "text"; // for textbox
                                    textboxInput.id = questionsArray[i].QuestionID;
                                    textboxInput.class = "answer";
                                    $("#questionBox").append("<tr>" + "<td>", textboxInput, "</td>" + "</tr>");
                                    feedbackArray.push([textboxInput, false, textboxInput.id]);

                                saveButton.type = "Button"; // for save button
                                saveButton.value = "Save";
                                $("#questionBox").append("<tr>" + "<td", saveButton, "</td>" + "</tr>");
                            }
                        }
                    }
                    accountWindowShowing = true;
                },
                error: function (e) {
                    alert("boo...");
                }
            });
        }

        function submitFeedback(name, department, rating, comment) {
            /*var webmethod = "../QuestionsService.asmx/AddResponseToList";
            var parameters = "{\"name\":\"" + encodeURI(name) + "\"}";


            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    alert("Item successfully added");
                    LoadList();
                },
                error: function (e) {
                    alert("boo...");
                }
            });*/


            // input.id = question id
            for (var i = 0; i < feedbackArray.length; i++) {
                userFeedbackInput = feedbackArray[i][0];
                if (userFeedbackInput.type == 'radio' && userFeedbackInput.checked) {
                    console.log(userFeedbackInput.value);
                }
                else if (userFeedbackInput.type == 'text') {
                    console.log(userFeedbackInput.value);
                }

                //console.log(feedbackArray[i][0].value);
            }
            
        }

    </script>
</head>
<body onload="loadQuestions()">
    <table class="center, questionBox" id="questionBox">
        <tr>
            <!--<th>QuestionID</th>-->
            <th>Question</th>
            <!--<th>QuestionType</th>
    <th>DepartmentName</th>-->
        </tr>
    </table>
    <input type="submit" id="submitButton" onclick="submitFeedback()"/>
</body>
</html>